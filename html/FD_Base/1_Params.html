
<meta charset="utf-8" />

<style>
	#form-1 label, .input {
		display: inline-block;
	}
	#form-1 label {
		width: 50%;
		text-align: right;
		margin-right: 5px;
	}

	#form-1 .input {
		width: 35%;
		
	}
	#form-1 .input-append {
		width: 100%;
		margin-bottom: 0;
	}
	#form-1 [type="text"] {
		width: 100%;
		padding: 2px 3px;
		margin-bottom: 0;
	}
	#form-1 .add-on {
		padding: 2px 3px;
		position: relative;
		margin-left: -22px;
		z-index: 2;
	}
</style>

<form id="form-1" method="post" action="modules/FD_ctl.jsp">
	<div class="block">
		<legend>
			<i class="icon-check"></i>编制设置 - 企业养老保险
		</legend>

		<fieldset>
			<legend>征缴相关参数</legend>
			<div class="row-fluid">
				<div class="span4">
					<div class="control-group">
						<label>个人缴费率</label>
						<div class="input">
							<div class="input-append">
								<input type="text" name="Indirate" />
								<span class="add-on">%</span>
							</div>
						</div>
					</div>
					<div class="control-group">
						<label>单位缴费率</label>
						<div class="input">
							<div class="input-append">
								<input type="text" name="Unitrate" />
								<span class="add-on">%</span>
							</div>
						</div>
					</div>
				</div>
				<div class="span4">
					<div class="control-group">
						<label>其他人员缴费率</label>
						<div class="input">
							<div class="input-append">
								<input type="text" name="Othertrate" />
								<span class="add-on">%</span>
							</div>
						</div>
					</div>
					<div class="control-group">
						<label>用人单位征缴率</label>
						<div class="input">
							<div class="input-append">
								<input type="text" name="Unitcorate" />
								<span class="add-on">%</span>
							</div>
						</div>
					</div>
				</div>
				<div class="span4">
					<div class="control-group">
						<label>其他人员征缴率</label>
						<div class="input">
							<div class="input-append">
								<input type="text" name="Othercorate" />
								<span class="add-on">%</span>
							</div>
						</div>
					</div>
				</div>
			</div>
		</fieldset>
		<!--<fieldset>
			<legend>利息相关参数</legend>
			<div class="row-fluid">
				<div class="span4">
					<div class="control-group">
						<label>定期存款金额</label>
						<div class="input">
							<input type="text" name="Deamount" />
						</div>
					</div>
					<div class="control-group">
						<label>定期存款年数</label>
						<div class="input">
							<input type="text" name="Deyears" />
						</div>
					</div>
				</div>
				<div class="span4">
					<div class="control-group">
						<label>定期存款年利率</label>
						<div class="input">
							<div class="input-append">
								<input type="text" name="Deyearpa" />
								<span class="add-on">%</span>
							</div>
						</div>
					</div>
					<div class="control-group">
						<label>当年到期定存额</label>
						<div class="input">
							<input type="text" name="Madeamount" />
						</div>
					</div>
				</div>
				<div class="span4">
					<div class="control-group">
						<label>活期存款金额</label>
						<div class="input">
							<input type="text" name="Dedeamount" />
						</div>
					</div>
					<div class="control-group">
						<label>活期存款利息</label>
						<div class="input">
							<input type="text" name="Dedeaminter" />
						</div>
					</div>
				</div>
			</div>
		</fieldset>
		<fieldset>
			<legend>其他相关参数</legend>
			<div class="row-fluid">
				<div class="span4">
					<div class="control-group">
						<label>财政补贴收入</label>
						<input type="text" name="Fsbincome" />
					</div>
					<div class="control-group">
						<label>其他收入</label>
						<input type="text" name="Otherincome" />
					</div>
					<div class="control-group">
						<label>转移收入人数</label>
						<input type="text" name="Traninpl" />
					</div>
					<div class="control-group">
						<label>转移收入金额</label>
						<input type="text" name="Traninmy" />
					</div>
				</div>
				<div class="span4">
					<div class="control-group">
						<label>上级补助收入</label>
						<input type="text" name="Hisub" />
					</div>
					<div class="control-group">
						<label>下级上解收入</label>
						<input type="text" name="Losub" />
					</div>
					<div class="control-group">
						<label>医疗补助金支出</label>
						<input type="text" name="Mepay" />
					</div>
					<div class="control-group">
						<label>丧葬抚恤支出</label>
						<input type="text" name="Aidpay" />
					</div>
				</div>
				<div class="span4">
					<div class="control-group">
						<label>转移支出人数</label>
						<input type="text" name="Tranoutpl" />
					</div>
					<div class="control-group">
						<label>转移支出金额</label>
						<input type="text" name="Tranoutmy" />
					</div>
					<div class="control-group">
						<label>补助下级指出</label>
						<input type="text" name="Hipay" />
					</div>
					<div class="control-group">
						<label>上级上解支出</label>
						<input type="text" name="Lopay" />
					</div>
				</div>
			</div>
		</fieldset>-->

		<div class="control-group">
			<input type="hidden" name="BZLX" value="1">
			<input type="submit" value="生成编制" class="btn btn-primary">
			<input type="button" id="btn-reset" value="重置" class="btn" />
		</div>
	</div>
</form>

<script>
	var budgetID = parseInt(getURLParams()['ID']) || undefined,
		$form = $frame.find('form');

	if (! budgetID) {
		$form.ajaxForm({
			data: {
				action: 'NewBudget'
			},
			success: function(data){
				var testData = {'ID': 123}
				var resObj = readResObj(data, testData);
				if (resObj['__ERROR__']) return;
				loadPage('html/FD_Budget/1_Edit.html?ID=' + resObj['ID']);
			}
		});
	} else {
		$form.ajaxForm({
			data: {
				action: 'EditParams',
				ID: budgetID
			},
			success: function(data){
				var testData = {
					budgetID: 123456
				}
				var resObj = readResObj(data, testData),
					msg = resObj['__MESSAGE__'];
				msg && notify(msg);
				loadPage('html/FD_Budget/1_Edit.html?ID=' + budgetID);
			}
		});
	}
	$form.find('#btn-reset').on('click', function() {
		if (confirm('当前所有修改都将撤销 是否确定重置表单?')) {
			$form[0].reset();
		}
	});

	$.get('modules/FD_ctl.jsp?action=InitBudget', {
		ID: budgetID
	}, function(data){
		try {
			var resObj = $.parseJSON(data),
				params = resObj['PARAMS']['myHashMap'];
			_.each(params, function(val, key){
				$form.find('[name="'+ key +'"]').val(val)
					.attr('placehodler', val);
			});
		} catch(err) {
			// 测试
			$form.find('[name]').each(function(i, el){
				var val = _.random(1000, 999999);
				$(el).val(val).attr('value', val)
					.attr('placehodler', val);
			});
		}
	});
</script>

