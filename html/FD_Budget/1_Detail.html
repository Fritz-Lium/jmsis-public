<meta charset="utf-8"/>

<style>
	#table th:nth-child(4),
	#table td:nth-child(4) {
		padding-left: 30px;
	}

	#table > thead > tr:last-child > th:nth-child(2), #table td:nth-child(2),
	#table > thead > tr:last-child > th:nth-child(3), #table td:nth-child(3),
	#table > thead > tr:last-child > th:nth-child(5), #table td:nth-child(5),
	#table > thead > tr:last-child > th:nth-child(6), #table td:nth-child(6) {
		min-width: 115px;
		padding: 5px;
		text-align: right;
	}
</style>

<table id="table" class="hidden" data-colspans="6">
	<script type="text/html" id="tmpl-titles">
		<caption>
			<i class="icon-th-list"></i>{{-year2}}年企业职工基本养老保险基金预算表<span id="test"></span>
		</caption>
		<thead>
		<tr>
			<th>社预02表</th>
			<th colspan="4">区域: 江门市</th>
			<th class="text-right">单位: 元</th>
		</tr>
		<tr>
			<th>项目</th>
			<th></th>
			<th></th>
			<th>项目</th>
			<th></th>
			<th></th>
		</tr>
		</thead>
	</script>
	<tbody>
	<tr>
		<td>一、基本养老保险费收入</td>
		<td></td>
		<td></td>
		<td>一、基本养老金支出</td>
		<td></td>
		<td></td>
	</tr>
	<tr>
		<td>二、利息收入</td>
		<td></td>
		<td></td>
		<td>二、医疗补助金支出</td>
		<td></td>
		<td></td>
	</tr>
	<tr>
		<td>三、财政补贴收入</td>
		<td></td>
		<td></td>
		<td>三、丧葬抚恤补助支出</td>
		<td></td>
		<td></td>
	</tr>
	<tr>
		<td>其中: 本级财政补助</td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
		<td></td>
	</tr>
	<tr>
		<td>四、其他收入</td>
		<td></td>
		<td></td>
		<td>四、其他支出</td>
		<td></td>
		<td></td>
	</tr>
	<tr>
		<td>五、转移收入</td>
		<td></td>
		<td></td>
		<td>五、转移支出</td>
		<td></td>
		<td></td>
	</tr>
	<tr>
		<td>六、本年收入小计</td>
		<td></td>
		<td></td>
		<td>六、本年支出小计</td>
		<td></td>
		<td></td>
	</tr>
	<tr>
		<td>七、上级补助收入</td>
		<td></td>
		<td></td>
		<td>七、补助下级支出</td>
		<td></td>
		<td></td>
	</tr>
	<tr>
		<td>八、下级上解收入</td>
		<td></td>
		<td></td>
		<td>八、上解上级支出</td>
		<td></td>
		<td></td>
	</tr>
	<tr>
		<td>九、本年收入合计</td>
		<td></td>
		<td></td>
		<td>九、本年支出合计</td>
		<td></td>
		<td></td>
	</tr>
	<tr>
		<td></td>
		<td></td>
		<td></td>
		<td>十、本年收支结余</td>
		<td></td>
		<td></td>
	</tr>
	<tr>
		<td>十、上年结余</td>
		<td></td>
		<td></td>
		<td>十一、年末滚存结余</td>
		<td></td>
		<td></td>
	</tr>
	<tr>
		<td>总计</td>
		<td></td>
		<td></td>
		<td>总计</td>
		<td></td>
		<td></td>
	</tr>
	</tbody>
	<tfoot>
	<tr>
		<td colspan="6">
			<div class="bulk-actions align-left">
				<button class="btn btn-default" href="html/FD_Budget.html">返回列表</button>
			</div>
		</td>
	</tr>
	</tfoot>
</table>

<script>
	var budgetID = parseInt(getURLParams()['ID']),
		$table = $frame.find('table');

	$.get('modules/FD_ctl.jsp?action=Detail', {
		'ID': budgetID
	}, function (data) {
		var testData = {"__MESSAGE__": "", "__ERROR__": false, "__NEXTACTION__": "", "TVALUES": {"myHashMap": {"C8": "0.00", "C7": "0.00", "C9": "0.00", "C3": "0.00", "C6": "0.00", "B11": "0.00", "CURYEAR": "2013", "E6": "0.00", "E7": "0.00", "B10": "0.00", "E8": "0.00", "E9": "0.00", "B13": "0.00", "B14": "0.00", "E2": "3,412,735,501.05", "E1": "2013年执行数", "E3": "0.00", "C1": "2013年预算数", "C2": "3,504,377,705.22", "F11": "0.00", "B3": "0.00", "B2": "3,504,377,705.22", "F10": "0.00", "B9": "0.00", "B8": "0.00", "B7": "0.00", "B6": "0.00", "F8": "0.00", "F9": "0.00", "F6": "0.00", "C10": "0.00", "F7": "0.00", "C11": "0.00", "C13": "0.00", "F13": "0.00", "C14": "0.00", "F14": "0.00", "F1": "2013年预算数", "E11": "0.00", "E10": "0.00", "E13": "0.00", "F3": "0.00", "F2": "3,412,735,501.05", "E14": "0.00", "B1": "2013年执行数"}}, "__LOGINED__": true, "__CURRENTUSER__": "admin", "__ISTEST__": true}


		var resObj = readResObj(data, testData);
		showTable(resObj);
	});

	function showTable(resObj) {
		$table.addClass('hidden');
		var year = parseInt(resObj['TVALUES']['myHashMap']['CURYEAR']),
			tValues = resObj['TVALUES']['myHashMap'],
			matrix = _.reduce(tValues, function (memo, val, key) {
				var mat = key.match(/^(\w)(\d+)$/);
				if (mat) {
					var c = parseInt(mat[1].charCodeAt(0) - 65),
						r = parseInt(mat[2] - 1);
					memo[r] = memo[r] || [];
					memo[r][c] = val;
				}
				return memo;
			}, []),
			$tmplTitles = $table.find('#tmpl-titles');
		$tmplTitles.after(_.template($tmplTitles.html(), {
			year1: year, year2: year + 1
		}));

		var $trows = $table.find('thead > tr:last, tbody > tr');
		_.each(matrix, function (row, i) {
			var $trow = $trows.eq(i);
			_.each(row, function (val, j) {
				if (_.isUndefined(val)) return;
				$trow.children().eq(j).text(val);
			});
		});
		if (resObj['__ISTEST__']) {
			$table.find('#test').text('(测试数据)');
		}
		$table.removeClass('hidden');
	}
</script>
